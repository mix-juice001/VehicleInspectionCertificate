<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0" />
    <title>File APIサンプル</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script>
        <!--

        function fuga1() {
            document.getElementById("firstRegister").value = "平成15年8月";
            document.getElementById("expirationDate").value = "2014年11月15日";
            document.getElementById("type").value = "LA";
        }

        function fuga2() {
            document.getElementById("type").value = "LA-SE3P";
        }

        function fuga3() {
            document.getElementById("carNumber").value = "";
        }

        function fuga4() {
            document.getElementById("carNumber").value = "川崎３００ほ１";
        }

        function fuga5() {
            document.getElementById("carNumber").value = "川崎３００ほ１０３";
            document.getElementById("carId").value = "SE3P-110564";
        }

        function bar() {
            var i = 0;
            return function() {
            console.log("aaa");
                i++;
                if (i == 1) return fuga1();
                if (i == 2) return fuga2();
                if (i == 3) return fuga4();
                if (i == 4) return fuga5();
            }
        }

        var f = bar();

        window.addEventListener("load", function(){
            if (!window.File){
                result.innerHTML = "File API 使用不可";
                return;
            }
            document.getElementById("imageFile").addEventListener("change", function(){
                var reader = new FileReader();

                reader.onload = function(event){
                    document.getElementById("image").src = reader.result;
                }
                var file = document.getElementById("imageFile").files[0];
                reader.readAsDataURL(file);
            }, true);

            //document.getElementById("submit").addEventListener("click", function() {alert("hoge");});

            document.getElementById("submit").addEventListener("click", function() {
                var canvas1 = document.querySelector("canvas");
  			    var ctx = canvas1.getContext("2d");
                ctx.drawImage(document.getElementById("image"), 0, 0, 800, 600);
                var im = document.getElementById("image");
                var imageData = ctx.getImageData(0, 0, im.width, im.height);
//			    console.log(canvas1.toDataURL('image/png'));
			    $("#param").val(canvas1.toDataURL('image/png'));
			    $.ajax({
				    type:"POST",
                    url:"http://192.168.1.101:8080/qr/read",
				    data:"q="+ canvas1.toDataURL('image/png'),
				    success:function(msg) {
				      f();
//				    	alert("success" + msg);
	    		    },
                    error:function(msg) {
                        alert(msg)
                    }
                });
//                f();
            });



//            document.getElementById("submit").addEventListener("click", function() {
//                var canvas1 = document.querySelector("canvas");
//  			    var ctx = canvas1.getContext("2d");
//                ctx.drawImage(document.getElementById("image"), 0, 0, 800, 600);
////            var imageData = ctx.getImageData(0, 0, canvas1.width, canvas1.height);
//                var im = document.getElementById("image");
//                var imageData = ctx.getImageData(0, 0, im.width, im.height);
//			    console.log(imageData);
//			    console.log(imageData.data);
//			    console.log("submit");
//			    console.log(canvas1.toDataURL('image/png'));
//			    $("#param").val(canvas1.toDataURL('image/png'));
//			    $.ajax({
//				    type:"POST",
////				    url:"http://localhost:8080/qr/read",
//                    url:"http://192.168.1.102:8080/qr/read",
//				    data:"q="+ canvas1.toDataURL('image/png'),
//				    //data:$form.serialize(),
//				    success:function(msg) {
//				    	alert("success" + msg);
//	    		    },
//                    error:function() {
//                        alert("error!")
//                    }
//
//                });
//            });
        }, true);
        -->
    </script>
</head>

<body>
<form>
    <input type="file" accept="image/*" id="imageFile"/>
</form>
        <!--<form id="form1" method="get">-->
            <input type="hidden" name="q" value="hoge" id="param"/>
            <input type="hidden" name="w" value="hoge" id="width"/>
            <input type="hidden" name="h" value="hoge" id="height"/>
            <input type="hidden" name="i" value="hoge" id="imageData"/>
        <!--</form>-->
<img id="image" width="300" height="200"/>
<button id="submit">submit</button>
<div id="result"/>
初年度登録： <input type="text" id="firstRegister" /><br/>
    有効期限の満了する日：<input type="text" id="expirationDate" /><br/>
    形式：<input type="text" id="type" /><br/>
    登録番号：<input type="text" id="carNumber" /><br/>
    車台番号：<input type="text" id="carId" /><br/>
<canvas id="canvas"  width="800" height="600" style="visibility:hidden"></canvas>



    
</body>
</html>